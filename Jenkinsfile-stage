#!groovy

node('master') {

    currentBuild.result = "SUCCESS"

    try {

       stage('Checkout'){

	checkout scm
	
	}

       stage('Docker-push') {

          withCredentials([usernamePassword(credentialsId: 'docker-hub-credentials', passwordVariable: 'dockerpassword', usernameVariable:'dockerusername')]) {
           sh '''
               docker login -u $dockerusername -p $dockerpassword
              '''
            }
           sh('sudo ./dockerPushToRepo-stage.sh')
}

	   stage('Docker-deploy'){
        sh '''
             ansible-playbook -i /home/deploy/ansible/dev-deploy/inventory/stage --extra-vars remote=stage /home/deploy/ansible/dev-deploy/stage-deploy.yml

           '''
}
}

    catch (err) {
        currentBuild.result = "FAILURE"
        throw err
    }

}

